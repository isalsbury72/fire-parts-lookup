<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Fire Parts Lookup v5.3.9</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <meta name="theme-color" content="#3b82f6">

  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0; background:#fafafa; color:#111; }
    header { position:sticky; top:0; background:#3b82f6; color:#fff; padding:10px 16px; display:flex; align-items:center; gap:12px; z-index:10; }
    header img { width:28px; height:28px; border-radius:6px; }
    h1 { font-size:18px; margin:0; }
    .ver { margin-left:auto; background:#fff; color:#1d4ed8; font-weight:600; padding:2px 8px; border-radius:999px; font-size:12px; display:inline-flex; align-items:center; gap:6px; }
    .auth-pill { background:#dcfce7; color:#166534; border-radius:999px; padding:2px 8px; font-size:11px; border:1px solid #22c55e; display:inline-flex; align-items:center; gap:4px; }

    main { padding:12px 16px 80px; max-width:960px; margin:0 auto; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:12px; box-shadow:0 1px 2px rgba(0,0,0,0.04); margin-bottom:12px; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    /* Buttons */
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:6px; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db; background:#fff; cursor:pointer; font-size:13px; }
    .btn-ghost { background:#ffffff; color:#374151; border-color:#9ca3af; }

    /* Home grid */
    .home-grid { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; }
    .home-tile { border-radius:14px; border:1px solid #d1d5db; padding:10px; background:#f9fafb; display:flex; flex-direction:column; cursor:pointer; min-height:80px; }

    /* Battery calculator */
    .batt-wrap { display:flex; flex-direction:column; gap:6px; }
    .batt-row { display:flex; align-items:center; justify-content:space-between; gap:6px; }
    .batt-label-pill,
    .batt-input-pill,
    .batt-required-pill {
      border-radius:999px; padding:6px 12px;
      font-size:12px; border:1px solid #e5e7eb; background:#f9fafb;
      display:flex; align-items:center;
    }
    .batt-input-pill input {
      width:100%; border:none; outline:none; background:transparent;
      text-align:right; font-size:12px;
    }
    .batt-required-pill {
      background:#f97316; border-color:#ea580c; color:#fff; font-weight:600;
    }
    .batt-tq-buttons { display:flex; gap:6px; margin-top:6px; }
    .batt-tq-btn { flex:1; border-radius:999px; border:1px solid #d1d5db; background:#f9fafb; padding:6px 10px; font-size:11px; cursor:pointer; }
    .batt-tq-btn.active { border-color:#2563eb; background:#eff6ff; color:#1d4ed8; }

  </style>
</head>
<body>

<header>
  <img src="icon-192.png" alt="Fire Parts">
  <div>
    <h1>Fire Parts Lookup</h1>
    <div class="small">Offline-friendly parts and quote helper</div>
  </div>
  <div class="ver">
    v5.3.9
    <span id="authBanner" class="auth-pill">Authorised users only</span>
  </div>
</header>

<main>

  <!-- HOME PAGE -->
  <div id="homePage">
    <div class="card">
      <h2 style="margin-top:0; font-size:16px;">Home</h2>
      <p class="small">Choose an area to jump into.</p>

      <div class="home-grid">
        <button id="btnHomeParts" class="home-tile">
          <div class="home-tile-title">Fire Parts lookup</div>
          <div class="home-tile-caption">Search parts, build quotes and cases.</div>
        </button>

        <button id="btnHomeBattery" class="home-tile">
          <div class="home-tile-title">Battery calculator</div>
          <div class="home-tile-caption">Quick capacity estimate for jobs.</div>
        </button>
      </div>
    </div>
  </div>

  <!-- BATTERY PAGE -->
  <div id="batteryPage" style="display:none;">
    <button class="btn btn-ghost" id="goHomeFromBattery">‚Üê Home</button>

    <div class="card">
      <h2 style="margin-top:0; font-size:16px;">Battery calculator</h2>
      <p class="small">Simple 20-hour capacity estimate using standby and alarm loads.</p>

      <div class="batt-wrap">

        <div class="batt-row">
          <div class="batt-label-pill">Quiescent current (Iq)</div>
          <div class="batt-input-pill">
            <input id="battIq" type="number" step="0.01" inputmode="decimal" placeholder="0.00">
          </div>
        </div>

        <div class="batt-row">
          <div class="batt-label-pill">Alarm mode current (Ia)</div>
          <div class="batt-input-pill">
            <input id="battIa" type="number" step="0.01" inputmode="decimal" placeholder="0.00">
          </div>
        </div>

        <div class="batt-row">
          <div class="batt-label-pill">Required quiescent time (Tq)</div>
          <div class="batt-input-pill"><span id="battTqDisplay">24 h</span></div>
        </div>

        <div class="batt-row">
          <div class="batt-label-pill">Required alarm standby (Ta)</div>
          <div class="batt-input-pill"><span id="battTaDisplay">0.5 h</span></div>
        </div>

        <div class="batt-row">
          <div class="batt-label-pill">Calculated 20-hour capacity</div>
          <div class="batt-input-pill"><span id="battCap20">0.00 Ah</span></div>
        </div>

        <div class="batt-row">
          <div class="batt-label-pill">Age factor (√ó1.25)</div>
          <div class="batt-input-pill"><span id="battAgeFactor">0.00 Ah</span></div>
        </div>

        <div class="batt-row">
          <div class="batt-label-pill">Required capacity</div>
          <div class="batt-required-pill">
            <span id="battRequiredCap">0.00 Ah</span>
          </div>
        </div>

        <div class="batt-tq-buttons">
          <button id="battBtnTq24" class="batt-tq-btn active">Tq 24 h</button>
          <button id="battBtnTq72" class="batt-tq-btn">Tq 72 h</button>
        </div>

      </div>
    </div>
  </div>
  <!-- PARTS PAGE -->
  <div id="partsPage" style="display:none;">
    <button class="btn btn-ghost" id="goHomeFromParts">‚Üê Home</button>

    <div class="card">
      <h2 style="margin-top:0; font-size:16px;">Parts lookup</h2>

      <div class="row" style="margin-bottom:8px;">
        <input id="q" type="search" placeholder="Search supplier, type, description or part number‚Ä¶">
      </div>

      <div class="row" style="margin-bottom:4px;">
        <label for="csv" class="btn">Load local CSV</label>
        <input id="csv" type="file" accept=".csv">
        <button id="loadShared" class="btn btn-secondary">Load shared file</button>
        <button id="clearCache" class="btn btn-secondary">Clear data</button>
      </div>

      <div class="hint">
        Showing <span id="count">0</span> items.<br>
        <span id="partsCsvSummary">CSV: None loaded</span>
      </div>

      <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
        <div class="copycell" id="copyArea" style="flex:1;"></div>
        <button id="copyPartLine" class="btn btn-ghost">Copy line</button>
        <button id="addToQuote"
                disabled
                class="btn"
                style="background:#f3f4f6; color:#9ca3af; border-color:#d1d5db; opacity:0.5; cursor:not-allowed;">
          Add to quote
        </button>
      </div>

      <table id="tbl">
        <thead>
          <tr>
            <th>Supplier</th>
            <th>Type</th>
            <th>Description</th>
            <th>Part #</th>
            <th>Price</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- QUOTE PAGE -->
  <div id="quotePage" style="display:none;">
    <button class="btn btn-ghost" id="goHomeFromQuote">‚Üê Home</button>

    <div class="card">
      <h2 style="margin-top:0; font-size:16px;">Quote items</h2>
      <p class="small">Parts you add from the Parts tab will appear here.</p>

      <table style="width:100%; border-collapse:collapse; margin-top:8px;" id="quoteTable">
        <thead>
          <tr>
            <th>Qty</th>
            <th>Supplier</th>
            <th>Description</th>
            <th>Part #</th>
            <th>Line total</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <p class="small" id="quoteSummary" style="margin-top:8px;">Total: $0.00</p>

      <!-- Manual item toggle -->
      <div class="card" style="margin-top:10px;">
        <div class="row" style="justify-content:space-between;">
          <h3 style="margin:0; font-size:14px;">Manual item</h3>
          <label class="small" style="display:flex; align-items:center; gap:6px;">
            <input type="checkbox" id="manualToggle"> Enable manual item entry
          </label>
        </div>

        <div id="manualSection" style="display:none; margin-top:10px;">
          <div class="row" style="gap:8px; flex-wrap:wrap;">
            <input id="manualSupplier" type="text" placeholder="Supplier *" class="bc-input" style="flex:1; min-width:160px;">
            <input id="manualDescription" type="text" placeholder="Description *" class="bc-input" style="flex:2; min-width:220px;">
            <input id="manualPart" type="text" placeholder="Part # *" class="bc-input" style="flex:1; min-width:120px;">
            <input id="manualPrice" type="text" placeholder="Price each *" class="bc-input" style="flex:1; min-width:160px;">
            <input id="manualQty" type="number" min="1" value="1" class="bc-input" style="width:100px;">
          </div>
          <div style="margin-top:8px; display:flex; gap:8px; justify-content:flex-end;">
            <button id="manualAddBtn" class="btn" style="border-color:#22c55e; background:#ecfdf5; color:#166534;">Add manual line</button>
          </div>
        </div>
      </div>

      <!-- Delivery + addresses -->
      <div style="margin-top:8px; display:flex; flex-direction:column; gap:8px;">
        <div style="display:flex; flex-wrap:wrap; gap:8px;">
          <div style="flex:1; min-width:160px;">
            <label class="small" for="jobNumber">Job number</label>
            <input id="jobNumber" type="text" class="bc-input" placeholder="Enter job number">
          </div>
          <div style="flex:1; min-width:220px;">
            <label class="small" for="deliveryAddress">Delivery address</label>
            <select id="deliveryAddress" class="bc-input">
              <option value="">Select delivery</option>
              <option>Delivery to Chubb 2 Lewis St Torrington QLD 4350</option>
              <option>Delivery to Chubb C/O Ian Salsbury 103 Diamantina Circle Karalee QLD 4306</option>
              <option>Delivery to Bryan Josai 43 Alexander St Wooroolin QLD 4608</option>
              <option>Delivery to Mark McCabe 8 Bushman St Plainland 4341</option>
              <option>I will order and pickup</option>
            </select>
          </div>
        </div>

        <!-- Action grid -->
        <div class="action-grid" style="margin-top:6px;">
          <button id="btnBuildCase" class="action-btn ghost">
            <div class="ico">üß©</div><div class="lbl">Build case</div>
          </button>
          <button id="copyQuote" class="action-btn dark">
            <div class="ico">üßæ</div><div class="lbl">Copy quote</div>
          </button>
          <button id="copyQuoteRaw" class="action-btn ghost">
            <div class="ico">üìã</div><div class="lbl">Copy items</div>
          </button>
          <button id="copyQuoteEmail" class="action-btn primary">
            <div class="ico">‚úâÔ∏è</div><div class="lbl">Copy for Email PO</div>
          </button>
          <button id="btnClearQuote" class="action-btn danger">
            <div class="ico">üóëÔ∏è</div><div class="lbl">Clear quote</div>
          </button>
          <button class="action-btn disabled" disabled>
            <div class="ico">‚è≥</div><div class="lbl">Reserved</div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- SETTINGS PAGE -->
  <div id="settingsPage" style="display:none;">
    <button class="btn btn-ghost" id="goHomeFromSettings">‚Üê Home</button>

    <div class="card">
      <h2 style="margin-top:0; font-size:16px;">Settings & diagnostics</h2>

      <div class="card" style="margin-top:8px;">
        <h3 style="margin:0 0 6px; font-size:14px;">Software versions</h3>
        <p class="small"><strong>App version:</strong> v5.3.9</p>
        <p class="small"><strong>Index version:</strong> <span id="diagIdxVersion">v5.3.9</span></p>
        <p class="small"><strong>Service worker cache:</strong> <span id="diagSwVersion">fpl-v5-3-9</span></p>
      </div>

      <div class="card" style="margin-top:8px;">
        <h3 style="margin:0 0 6px; font-size:14px;">Data & status</h3>
        <p class="small"><strong>CSV source:</strong> <span id="diagCsvSource">None loaded</span></p>
        <p class="small"><strong>Last CSV loaded:</strong> <span id="diagLastLoaded">‚Äî</span></p>
        <p class="small"><strong>Rows loaded:</strong> <span id="diagPartsRows">0</span></p>
        <p class="small"><strong>Quote items:</strong> <span id="diagQuoteItems">0</span></p>
        <p class="small"><strong>Routine visit:</strong> <span id="diagRoutine">Not set</span></p>
        <p class="small"><strong>Service worker:</strong> <span id="diagSwStatus">Checking‚Ä¶</span></p>
      </div>

      <div class="card" style="margin-top:8px;">
        <h3 style="margin:0 0 6px; font-size:14px;">Maintenance</h3>
        <button id="btnDiagClearAll" class="btn btn-danger">Clear all data</button>
        <p class="small" style="margin-top:6px; color:#b91c1c;">This clears cached CSV, quotes, and routine setting.</p>
      </div>

      <div class="card" style="margin-top:8px;">
        <h3 style="margin:0 0 6px; font-size:14px;">Export debug info</h3>
        <button id="btnDiagCopy" class="btn btn-secondary" style="margin-top:6px;">Copy info</button>
      </div>
    </div>
  </div>

  <!-- BUILD CASE 1 -->
  <div id="buildcase1Page" style="display:none;">
    <button class="btn btn-ghost" id="goHomeFromBuild1">‚Üê Home</button>

    <div class="card">
      <p class="step-title">Build case - Step 1</p>
      <p class="muted">Notes collection.</p>

      <div class="card" style="margin-top:8px;">
        <label class="small">Notes to customer</label>
        <textarea id="notesCustomer" class="bc-textarea"></textarea>
      </div>

      <div class="card" style="margin-top:8px;">
        <div style="display:flex; justify-content:space-between;">
          <label class="small">Notes to estimator</label>
          <span id="bc1ItemsCount" class="pill">Items: 0</span>
        </div>
        <textarea id="notesEstimator" class="bc-textarea"></textarea>
      </div>

      <div style="margin-top:10px; display:flex; gap:8px;">
        <button id="btnBackToQuote" class="btn" style="border-color:#3b82f6; color:#1d4ed8;">Back to Quote</button>
        <button id="btnToBuild2" class="btn" style="border-color:#16a34a; background:#ecfdf5; color:#166534;">Continue</button>
      </div>
    </div>
  </div>

  <!-- BUILD CASE 2 -->
  <div id="buildcase2Page" style="display:none;">
    <button class="btn btn-ghost" id="goHomeFromBuild2">‚Üê Home</button>

    <div class="card">
      <p class="step-title">Build case - Step 2</p>
      <p class="muted">Scheduling and resource details.</p>

      <div class="card" style="margin-top:8px;">
        <div class="pill" style="margin-bottom:10px;">
          <span>On next routine visit?</span>
          <label><input type="radio" name="routineVisit" id="routineYes" value="yes"> Yes</label>
          <label><input type="radio" name="routineVisit" id="routineNo" value="no"> No</label>
        </div>

        <!-- Accommodation -->
        <div class="row">
          <div>
            <label class="small">Nights</label><br>
            <input id="accomNights" class="bc-input bc-input--tiny" type="number" min="0" step="1">
          </div>
        </div>

        <div class="card" style="background:#f9fafb;">
          <p class="small"><strong>Normal Time</strong></p>
          <div class="row">
            <div><label class="small">Labour hours</label><br><input id="labourHoursNormal" class="bc-input bc-input--tiny" type="number"></div>
            <div><label class="small">Techs</label><br><input id="numTechsNormal" class="bc-input bc-input--tiny" type="number"></div>
            <div><label class="small">Travel hrs</label><br><input id="travelHoursNormal" class="bc-input bc-input--tiny" type="number"></div>
          </div>
        </div>

        <div class="card" style="background:#f9fafb; margin-top:8px;">
          <p class="small"><strong>After Hours</strong></p>
          <div class="row">
            <div><label class="small">Labour hours</label><br><input id="labourHoursAfter" class="bc-input bc-input--tiny" type="number"></div>
            <div><label class="small">Techs</label><br><input id="numTechsAfter" class="bc-input bc-input--tiny" type="number"></div>
            <div><label class="small">Travel hrs</label><br><input id="travelHoursAfter" class="bc-input bc-input--tiny" type="number"></div>
          </div>
        </div>

      </div>

      <div style="margin-top:10px; display:flex; gap:8px;">
        <button id="btnBackToBuild1" class="btn">Back</button>
        <button id="btnToBuild3" class="btn" style="border-color:#16a34a; background:#ecfdf5; color:#166534;">Continue</button>
      </div>
    </div>
  </div>

  <!-- BUILD CASE 3 -->
  <div id="buildcase3Page" style="display:none;">
    <button class="btn btn-ghost" id="goHomeFromBuild3">‚Üê Home</button>

    <div class="card">
      <p class="step-title">Build case - Step 3</p>
      <p class="muted">Final review.</p>

      <div class="card" style="margin-top:8px;">
        <div style="display:flex; justify-content:space-between;">
          <label class="small">Notes to customer</label>
          <button id="btnCopyNC3" class="btn btn-primary">Copy</button>
        </div>
        <textarea id="notesCustomer3" class="bc-textarea"></textarea>
      </div>

      <div class="card" style="margin-top:8px;">
        <div style="display:flex; justify-content:space-between;">
          <div style="display:flex; gap:8px;">
            <label class="small">Notes to estimator</label>
            <span id="bc3ItemsCount" class="pill">Items: 0</span>
          </div>
          <button id="btnCopyNE3" class="btn btn-primary">Copy</button>
        </div>
        <textarea id="notesEstimator3" class="bc-textarea"></textarea>
      </div>

      <div style="margin-top:10px; display:flex; gap:8px;">
        <button id="btnBackToBuild2" class="btn">Back</button>
        <button id="btnBackToQuoteFrom3" class="btn" style="border-color:#3b82f6; color:#1d4ed8;">Back to Quote</button>
      </div>
    </div>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="app.js"></script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>

</body>
</html>

  
