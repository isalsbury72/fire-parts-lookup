<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Battery Capacity Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: #f3f4f6;
      color: #111827;
      display: flex;
      justify-content: center;
    }
    .page {
      max-width: 480px;
      width: 100%;
      padding: 12px 12px 16px;
      box-sizing: border-box;
    }
    header {
      text-align: center;
      margin-bottom: 8px;
    }
    header h1 {
      font-size: 18px;
      margin: 0;
    }
    header .sub {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 4px 0;
    }

    .row-label {
      font-size: 13px;
      color: #374151;
      flex: 1;
      min-width: 0;
    }

    .row-pill {
      flex: 0 0 130px;
      max-width: 130px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      padding: 4px 10px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      transition: box-shadow 0.15s ease, border-color 0.15s ease, background 0.15s ease;
    }

    .row-focus {
      border-color: #3b82f6;
      background: #eff6ff;
      box-shadow: 0 0 0 2px rgba(59,130,246,0.25);
    }

    .row-pill input {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      font-size: 13px;
      text-align: right;
      color: #111827;
      padding: 0;
      margin: 0;
      -moz-appearance: textfield;
    }
    .row-pill input::-webkit-outer-spin-button,
    .row-pill input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .row-pill span.value {
      font-size: 13px;
      text-align: right;
      width: 100%;
      display: inline-block;
    }

    /* Special pills */
    .pill-result {
      background: #fff7ed;
      border-color: #fdba74;
    }
    .pill-required {
      background: #f97316;
      border-color: #ea580c;
      color: #fff7ed;
    }
    .pill-required span.value {
      color: #fff7ed;
      font-weight: 600;
    }

    .hint {
      font-size: 10px;
      color: #6b7280;
      margin-top: 2px;
      text-align: right;
    }

    .buttons-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      color: #111827;
      min-width: 90px;
      text-align: center;
    }
    .btn-primary {
      border-color: #3b82f6;
      background: #eff6ff;
      color: #1d4ed8;
    }
    .btn:active {
      transform: translateY(1px);
    }

    footer {
      margin-top: 6px;
      text-align: center;
      font-size: 10px;
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Battery Capacity</h1>
      <div class="sub">C = L × [(Iq × Tq) + Fc × (Ia × Ta)]</div>
    </header>

    <div class="card">
      <!-- Quiescent current Iq -->
      <div class="row" data-row="iq">
        <div class="row-label">Quiescent current (Iq) [A]</div>
        <div class="row-pill">
          <input id="iqInput" type="number" step="0.01" min="0" value="0.00">
        </div>
      </div>

      <!-- Alarm current Ia -->
      <div class="row" data-row="ia">
        <div class="row-label">Alarm mode current (Ia) [A]</div>
        <div class="row-pill">
          <input id="iaInput" type="number" step="0.01" min="0" value="0.00">
        </div>
      </div>

      <!-- Required quiescent time Tq (24 / 72, set via buttons) -->
      <div class="row">
        <div class="row-label">Required quiescent time Tq [h]</div>
        <div class="row-pill">
          <span id="tqValue" class="value">24.00</span>
        </div>
      </div>

      <!-- Required alarm standby time Ta (fixed 0.5) -->
      <div class="row">
        <div class="row-label">Required alarm standby time Ta [h]</div>
        <div class="row-pill">
          <span id="taValue" class="value">0.50</span>
        </div>
      </div>

      <!-- Calculated 20 hour capacity (no age factor) -->
      <div class="row">
        <div class="row-label">Calculated 20 hr capacity [Ah]</div>
        <div class="row-pill pill-result">
          <span id="c20Value" class="value">0.00</span>
        </div>
      </div>
      <div class="hint">Uses L = 1, Fc = 2</div>

      <!-- Age factor result (C × 1.25) -->
      <div class="row">
        <div class="row-label">Age factor (C × 1.25) [Ah]</div>
        <div class="row-pill pill-result">
          <span id="ageValue" class="value">0.00</span>
        </div>
      </div>

      <!-- Required capacity (same as age result, highlighted) -->
      <div class="row">
        <div class="row-label">Required capacity [Ah]</div>
        <div class="row-pill pill-required">
          <span id="requiredValue" class="value">0.00</span>
        </div>
      </div>

      <!-- Tq buttons at the bottom, per your request -->
      <div class="buttons-row">
        <button id="btnTq24" class="btn btn-primary">Tq 24 h</button>
        <button id="btnTq72" class="btn">Tq 72 h</button>
      </div>
    </div>

    <footer>
      L = 1, Fc = 2, Ta = 0.5 h, age factor = 1.25
    </footer>
  </div>

  <script>
    // Constants
    const L = 1;
    const Fc = 2;
    const Ta = 0.5;
    const AGE_FACTOR = 1.25;

    // Elements
    const iqInput = document.getElementById('iqInput');
    const iaInput = document.getElementById('iaInput');
    const tqValue = document.getElementById('tqValue');
    const taValue = document.getElementById('taValue'); // fixed 0.5

    const c20Value = document.getElementById('c20Value');
    const ageValue = document.getElementById('ageValue');
    const requiredValue = document.getElementById('requiredValue');

    const btnTq24 = document.getElementById('btnTq24');
    const btnTq72 = document.getElementById('btnTq72');

    // Focus highlighting for rows
    document.querySelectorAll('.row[data-row]').forEach(row => {
      const pill = row.querySelector('.row-pill');
      const input = row.querySelector('input');
      if (!pill || !input) return;

      input.addEventListener('focus', () => {
        pill.classList.add('row-focus');
      });
      input.addEventListener('blur', () => {
        pill.classList.remove('row-focus');
      });
    });

    // State
    let Tq = 24; // hours, default

    function parseNum(val) {
      const n = parseFloat((val || '').toString());
      return Number.isNaN(n) ? 0 : n;
    }

    function formatNum(n) {
      return n.toFixed(2);
    }

    function recalc() {
      const Iq = parseNum(iqInput.value);
      const Ia = parseNum(iaInput.value);

      // Ensure display formatting (right aligned, 2dp)
      iqInput.value = formatNum(Iq);
      iaInput.value = formatNum(Ia);
      tqValue.textContent = formatNum(Tq);
      taValue.textContent = formatNum(Ta);

      // C = L × [(Iq × Tq) + Fc × (Ia × Ta)]
      const bracket = (Iq * Tq) + Fc * (Ia * Ta);
      const C20 = L * bracket;
      const aged = C20 * AGE_FACTOR;

      c20Value.textContent = formatNum(C20);
      ageValue.textContent = formatNum(aged);
      requiredValue.textContent = formatNum(aged);
    }

    // Input listeners
    iqInput.addEventListener('change', recalc);
    iqInput.addEventListener('input', recalc);
    iaInput.addEventListener('change', recalc);
    iaInput.addEventListener('input', recalc);

    // Tq buttons
    btnTq24.addEventListener('click', () => {
      Tq = 24;
      btnTq24.classList.add('btn-primary');
      btnTq72.classList.remove('btn-primary');
      recalc();
    });

    btnTq72.addEventListener('click', () => {
      Tq = 72;
      btnTq72.classList.add('btn-primary');
      btnTq24.classList.remove('btn-primary');
      recalc();
    });

    // Initial calculation
    recalc();
  </script>
</body>
</html>

